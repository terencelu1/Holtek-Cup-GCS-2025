<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D 地圖測試 - UAV × UGV Control Center</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MapLibre GL JS -->
    <link href='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css' rel='stylesheet' />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/map_3d_test.css') }}">
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="navbar navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <div class="d-flex align-items-center">
                <button class="sidebar-toggle me-2" id="sidebarToggle" title="摺疊/展開側邊欄">
                    <i class="fas fa-bars"></i>
                </button>
                <span class="navbar-brand mb-0 h1">
                    <i class="fas fa-cube"></i> 3D 地圖測試
                </span>
            </div>
            <div class="navbar-nav flex-row">
                <div class="nav-item me-3">
                    <a href="/map" class="btn btn-sm btn-outline-light">
                        <i class="fas fa-arrow-left"></i> 返回原地圖
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Side Navigation -->
    <div class="sidebar" id="sidebar">
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link" href="/">
                    <i class="fas fa-home"></i>
                    <span class="nav-text">總覽</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" href="/map">
                    <i class="fas fa-map"></i>
                    <span class="nav-text">地圖與任務</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/performance">
                    <i class="fas fa-chart-line"></i>
                    <span class="nav-text">性能與紀錄</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/system">
                    <i class="fas fa-cog"></i>
                    <span class="nav-text">系統與電源</span>
                </a>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container-fluid">
            <div class="row">
                <!-- Left Column: Controls -->
                <div class="col-lg-3">
                    <!-- View Controls -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-video"></i> 視角控制</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label small">傾斜角度:</label>
                                <input type="range" class="form-range" id="pitchSlider" min="0" max="70" value="45">
                                <div class="text-center small" id="pitchValue">45°</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label small">旋轉角度:</label>
                                <input type="range" class="form-range" id="bearingSlider" min="-180" max="180" value="0">
                                <div class="text-center small" id="bearingValue">0°</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label small">縮放等級:</label>
                                <input type="range" class="form-range" id="zoomSlider" min="10" max="20" value="18" step="0.1">
                                <div class="text-center small" id="zoomValue">18</div>
                            </div>
                            <div class="row g-2">
                                <div class="col-6">
                                    <button class="btn btn-sm btn-primary w-100" id="resetViewBtn">
                                        <i class="fas fa-undo"></i> 重置視角
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button class="btn btn-sm btn-success w-100" id="followUAVBtn">
                                        <i class="fas fa-plane"></i> 跟隨 UAV
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Waypoint Manager -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-map-marker-alt"></i> 航點管理</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <button class="btn btn-sm btn-primary w-100" id="addWaypointBtn">
                                    <i class="fas fa-plus"></i> 點擊地圖新增航點
                                </button>
                            </div>
                            <div class="mb-3">
                                <label class="form-label small">目標載具:</label>
                                <select class="form-select form-select-sm" id="waypointVehicleSelect">
                                    <option value="UAV1">UAV1</option>
                                    <option value="UGV1">UGV1</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label small">航點高度 (m):</label>
                                <div class="input-group input-group-sm">
                                    <input type="number" class="form-control" id="waypointAltitude" value="50" min="0" max="200">
                                    <span class="input-group-text">m</span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted">航點列表 (<span id="waypointCount">0</span>)</small>
                                    <button class="btn btn-sm btn-outline-danger btn-xs" id="clearWaypointsBtn">
                                        <i class="fas fa-trash"></i> 清除全部
                                    </button>
                                </div>
                                <div id="waypointList" class="waypoint-list">
                                    <div class="text-center text-muted small py-3">
                                        點擊「新增航點」後，再點擊地圖上的位置
                                    </div>
                                </div>
                            </div>
                            <div class="d-grid gap-2">
                                <button class="btn btn-sm btn-success" id="executeWaypointsBtn" disabled>
                                    <i class="fas fa-play"></i> 執行航點任務
                                </button>
                                <button class="btn btn-sm btn-warning" id="previewRouteBtn" disabled>
                                    <i class="fas fa-eye"></i> 預覽路線
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Mission Manager -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-tasks"></i> 任務管理</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label small">載具:</label>
                                <select class="form-select form-select-sm" id="missionVehicleSelect">
                                    <option value="UAV1">UAV1</option>
                                    <option value="UGV1">UGV1</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label small">任務類型:</label>
                                <select class="form-select form-select-sm" id="missionTypeSelect">
                                    <optgroup label="UAV 任務">
                                        <option value="follow_ugv">Follow UGV（追蹤無人車）</option>
                                        <option value="auto_land">Auto Land on UGV（降落）</option>
                                        <option value="land">Land（降落模式）</option>
                                        <option value="patrol">Patrol Route（定期巡邏）</option>
                                        <option value="rtl">Return to Home</option>
                                    </optgroup>
                                    <optgroup label="UGV 任務">
                                        <option value="follow_uav">Follow UAV</option>
                                        <option value="charge_station">Go to Charge Station</option>
                                        <option value="patrol_ugv">巡邏路線</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="mb-3">
                                <button class="btn btn-sm btn-success w-100" id="startMissionBtn">
                                    <i class="fas fa-play"></i> 開始任務
                                </button>
                            </div>
                            <div class="mb-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">進行中的任務</small>
                                    <small class="badge bg-secondary" id="missionCount">0</small>
                                </div>
                            </div>
                            <div id="missionList" class="mission-list">
                                <div class="text-center text-muted small py-2">
                                    無進行中的任務
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Map Style -->
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-palette"></i> 地圖樣式</h6>
                        </div>
                        <div class="card-body">
                            <select class="form-select form-select-sm" id="mapStyleSelect">
                                <option value="osm" selected>OpenStreetMap</option>
                                <option value="satellite">衛星影像</option>
                                <option value="dark">深色模式</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Right Column: 3D Map -->
                <div class="col-lg-9">
                    <div id="map"></div>
                    <!-- Map Info Overlay -->
                    <div class="map-info">
                        <div class="info-item">
                            <i class="fas fa-mouse-pointer"></i>
                            左鍵拖曳旋轉視角，右鍵拖曳傾斜，滾輪縮放
                        </div>
                    </div>
                    <!-- Map Controls -->
                    <div class="map-controls">
                        <button type="button" class="btn btn-sm btn-light" id="clearTrailsBtn" title="清除軌跡">
                            <i class="fas fa-eraser"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-light" id="centerMapBtn" title="居中顯示">
                            <i class="fas fa-crosshairs"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- MapLibre GL JS -->
    <script src='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js'></script>
    <!-- Sidebar Script -->
    <script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/map_3d_test.js') }}"></script>
</body>
</html>

